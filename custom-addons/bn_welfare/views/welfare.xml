<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="welfare_view_tree" model="ir.ui.view">
        <field name="name">welfare.view.tree</field>
        <field name="model">welfare</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name" />
                <field name="donee_id" />
                <field name="date" />
                <field name="state" widget="badge" decoration-warning="state == 'draft'" decoration-info="state not in ['recurring_order', 'disbursed']" decoration-success="state in ['recurring_order', 'disbursed']" />
            </tree>
        </field>
    </record>

    <record id="welfare_view_form" model="ir.ui.view">
        <field name="name">welfare.view.form</field>
        <field name="model">welfare</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button string="Send for Inquiry" name="action_send_for_inquiry" type="object" class="oe_highlight" invisible="state != 'draft'" />
                    <button string="Check Portal Status" name="action_check_portal_status" type="object" class="oe_highlight" invisible="state != 'send_for_inquiry'" />
                    <button string="Move to HOD" name="action_move_to_hod" type="object" class="oe_highlight" invisible="state != 'inquiry'" />
                    <button string="Move to Member" name="action_move_to_member" type="object" class="oe_highlight" invisible="state != 'hod_approve'" />
                    <button string="Approve" name="action_approve" type="object" class="oe_highlight" invisible="state != 'mem_approve'" />
                    <button string="Create Recurring Orders" name="action_create_recurring_order" type="object" class="oe_highlight" invisible="state != 'approve'" />
                    
                    <button string="Reject" name="action_reject" type="object" />

                    <field name="state" widget="statusbar" statusbar_visible="draft, send_for_inquiry, inquiry, hod_approve, mem_approve, approve, disbursed" />
                </header>

                <sheet>
                    <div class="oe_title">
                        <label for="name" string="Name"/>
                        <h1><field name="name" class="oe_inline" readonly="1" /></h1>
                    </div>

                    <group>
                        <group name="welfare_col_1">
                            <field name="employee_category_id" invisible="1" />
                            <field name="is_synced" readonly="1" invisible="1" />

                            <field name="donee_id" options="{'no_create': True, 'no_edit': True, 'no_open': True}" domain="[('category_id.name', 'in', ['Donee'])]" readonly="state in ['recurring', 'disbursed']" required="1" />
                            <field name="employee_id" string="Inquiry Officer" domain="[('category_ids', 'in', [employee_category_id])]" options="{'no_create': True, 'no_edit': True, 'no_open': True}" readonly="state in ['recurring', 'disbursed'] or state != 'inquiry'" />
                            <field name="cnic_no" readonly="state in ['recurring', 'disbursed']" />
                            <field name="cnic_expiration_date" readonly="state in ['recurring', 'disbursed']" />
                            <field name="father_name" readonly="state in ['recurring', 'disbursed']" />
                            <field name="father_cnic_no" readonly="state in ['recurring', 'disbursed']" />
                            <field name="portal_sync_status" options="{'horizontal': True}" widget="radio" readonly="1" invisible="not is_synced" />
                            <field name="hod_remarks" readonly="state in ['recurring', 'disbursed'] or state != 'hod_approve'" required="state == 'hod_approve'"  />
                            <field name="member_remarks" readonly="state in ['recurring', 'disbursed'] or state != 'mem_approve'" required="state == 'mem_approve'" />
                        </group>
                        <group name="welfare_col_2">
                            <field name="application_form_name" invisible="1"/>
                            <field name="application_form" filename="application_form_name" readonly="state != 'draft'" required="1"/>
                            <field name="frc_name" invisible="1"/>
                            <field name="frc" filename="frc_name" readonly="state != 'draft'" required="1"/>
                            <field name="electricity_bill_name" invisible="1"/>
                            <field name="electricity_bill_file" filename="electricity_bill_name" readonly="state != 'draft'" required="1"/>
                            <field name="gas_bill_name" invisible="1"/>
                            <field name="gas_bill_file" filename="gas_bill_name" readonly="state != 'draft'" required="1"/>
                            <field name="family_cnic_name" invisible="1"/>
                            <field name="family_cnic" filename="family_cnic_name" readonly="state != 'draft'" required="1"/>
                            
                            <field name="old_system_id" readonly="state != 'draft'"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="welfare_line" string="Disbursement Items">
                            <field name="welfare_line_ids" readonly="state != 'draft'">
                                <tree editable="bottom">
                                    <field name="product_domain" column_invisible="1" />

                                    <field name="order_type" />
                                    <field name="recurring_duration" invisible="order_type != 'recurring'" />
                                    <field name="disbursement_category_id" options="{'no_create': True, 'no_edit': True, 'no_open': True}" />
                                    <field name="disbursement_application_type_id" options="{'no_create': True, 'no_edit': True, 'no_open': True}" />
                                    <field name="product_id" domain="product_domain" options="{'no_create': True, 'no_edit': True, 'no_open': True}" />
                                    <field name="collection_point" />
                                    <field name="analytic_account_id" options="{'no_create': True, 'no_edit': True, 'no_open': True}" domain="[('location_option_id.name', '=', 'Branch')]" invisible="collection_point == 'bank'" />
                                    <field name="collection_date" />
                                    <field name="marriage_date" invisible="disbursement_category_id.name != 'Marriage / Wedding'" />
                                    <field name="amount" />
                                </tree>
                            </field>
                        </page>
                        <page name="recurring_line" string="Recurring Details" invisible="portal_sync_status != 'recurring'">
                            <field name="welfare_recurring_line_ids" readonly="1">
                                <tree>
                                    <field name="disbursement_category_id" options="{'no_create': True, 'no_edit': True, 'no_open': True}" />
                                    <field name="disbursement_application_type_id" options="{'no_create': True, 'no_edit': True, 'no_open': True}" />
                                    <field name="product_id" options="{'no_create': True, 'no_edit': True, 'no_open': True}" />
                                    <field name="collection_point" />
                                    <field name="analytic_account_id" options="{'no_create': True, 'no_edit': True, 'no_open': True}" />
                                    <field name="collection_date" />
                                    <field name="amount" />
                                </tree>
                            </field>
                        </page>
                        <page name="portal_details" string="Portal Details" invisible="portal_sync_status != 'synced'">
                            <group>
                                <group name="portal_details_col_1">
                                    <field name="portal_application_id" readonly="1" />
                                    <field name="last_sync_date" readonly="1" />
                                </group>
                                <group name="portal_details_col_2">
                                    <field name="portal_donee_id" readonly="1" />
                                    <field name="portal_review_notes" readonly="1" />
                                </group>
                            </group>
                        </page>
                        <page name="employee_info" string="Employee Info.">
                            <group>
                                <group name="employee_info_col_1">
                                    <field name="company_name" />
                                    <field name="company_phone" />
                                    <field name="company_address" />
                                </group>
                                <group name="employee_info_col_2">
                                    <field name="designation" />
                                    <field name="service_duration" />
                                    <field name="monthly_salary" />
                                </group>
                            </group>
                        </page>
                        <page name="education_info" string="Education Info.">
                            <field name="educaiton_line_ids">
                                <tree editable="bottom">
                                    <field name="examination" />
                                    <field name="school_uni_center" />
                                    <field name="board" />
                                    <field name="percentage" />
                                    <field name="passing_year" />
                                </tree>
                            </field>
                        </page>
                        <page name="house_ownership_residency_detail" string="House Ownership / Residency Details">
                            <group>
                                <group name="house_ownership_residency_detail_col_1">
                                    <field name="residence_type" options="{'horizontal': True}" widget="radio" />
                                    <field name="home_phone_no" />
                                    <field name="rental_shared_duration" />
                                    <field name="electricity_bill" />
                                    <field name="gas_bill" />
                                </group>
                                <group name="house_ownership_residency_detail_col_2">
                                    <field name="landlord_name" />
                                    <field name="landlord_cnic_no" />
                                    <field name="landlord_mobile" />
                                    <field name="home_other_info" />
                                    <field name="per_month_rent" />
                                </group>
                            </group>
                        </page>
                        <page name="other_finance" string="Other Finance">
                            <group>
                                <group name="other_finance_col_1">
                                    <field name="monthly_income" />
                                    <field name="bank_account" options="{'horizontal': True}" widget="radio" />
                                    <field name="bank_name" invisible="bank_account == 'no'" />
                                    <field name="account_no" invisible="bank_account == 'no'" />
                                </group>
                                <group name="other_finance_col_2">
                                    <field name="monthly_household_expense" />
                                    <field name="other_loan" />
                                    <field name="institute_name" invisible="other_loan == 'no'" />
                                    <field name="outstanding_amount" invisible="other_loan == 'no'" />
                                </group>
                            </group>
                        </page>
                        <page name="other_information" string="Other Information">
                            <group>
                                <group name="other_information_col_1">
                                    <field name="aid_from_other_organization" />
                                    <field name="details_1" />
                                </group>
                                <group name="other_information_col_2">
                                    <field name="have_applied_swit" />
                                    <field name="details_2" />
                                </group>
                            </group>
                        </page>
                        <page name="request_details" string="Request Details">
                            <group>
                                <group name="request_details_col_1">
                                    <field name="loan_request_amount" />
                                    <field name="security_offered" />
                                </group>
                                <group name="request_details_col_2">
                                    <field name="loan_tenure_expected" />
                                </group>
                            </group>
                        </page>
                        <page name="guarantor_information" string="Guarantor Information">
                            <field name="guarantor_line_ids">
                                <tree editable="bottom">
                                    <field name="name" />
                                    <field name="father_spouse_name" />
                                    <field name="cnic_no" />
                                    <field name="relation" />
                                    <field name="address" />
                                    <field name="mobile" />
                                    <field name="landline_no" />
                                </tree>
                            </field>
                        </page>
                        <page name="family_member" string="Family Details">
                            <group>
                                <group name="family_member_col_1">
                                    <field name="dependent_person" />
                                </group>
                                <group name="family_member_col_2">
                                    <field name="household_member" />
                                </group>
                            </group>
                            <field name="family_line_ids">
                                <tree editable="bottom">
                                    <field name="complete_name" />
                                    <field name="age" />
                                    <field name="relation" />
                                    <field name="cnic_b_form_name" column_invisible="1"/>
                                    <field name="cnic_b_form" filename="cnic_b_form_name"/>
                                    <field name="education" />
                                    <field name="monthly_income" />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="welfare_action" model="ir.actions.act_window">
        <field name="name">Welfare</field>
        <field name="res_model">welfare</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Let's create a Disbursement Request....
            </p>
        </field>
    </record>

    <menuitem
        id="welfare_menu"
        name="Welfare"
        web_icon="bn_welfare,static/description/icon.png"
        groups="bn_welfare.welfare_group"
        sequence="6"/>

    <menuitem
        id="disbursement_request_menu"
        name="Disbursement Request"
        action="welfare_action"
        parent="welfare_menu"
        sequence="0"/>

</odoo>
