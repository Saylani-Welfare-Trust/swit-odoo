<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="action_report_donation_form" model="ir.actions.report">
        <field name="name">Donation</field>
        <field name="model">donation.data</field>
        <field name="report_type">qweb-html</field>
        <field name="report_name">sm_rest_api.donation_form</field>
        <field name="report_file">sm_rest_api.donation_form</field>
        <field name="print_report_name">'%s' % object.name</field>
        <field name="binding_model_id" ref="model_donation_data"/>
        <field name="binding_type">report</field>
    </record>

    <template id="donation_form">
        <t t-call="web.html_container">
            <script>
                function PrintClient() {
                    var receiptHtml = $('.print').html();
                    var w = window.open();
                    if(w) {
                        $('link[rel="stylesheet"]').each(function() {
                            w.document.head.appendChild(this.cloneNode(true));
                        });
                        var styleElement = document.querySelector('style');
                        if (styleElement) {
                            var style = document.createElement('style');
                            style.innerHTML = styleElement.innerHTML;
                            w.document.head.appendChild(style);
                        }

                        w.document.write(receiptHtml);
                        w.document.close();
                        w.onload = function() {
                            w.print();
                            w.close();
                        };
                    }
                }
                document.addEventListener('DOMContentLoaded', function() {
                    var print = document.querySelectorAll('.o_control_panel_main_buttons');
                    console.log(print);

                    if (print.length > 0) {
                        print.forEach(function(el) {
                            el.style.setProperty('display', 'none', 'important');
                        });
                    }
                });
            </script>

            <div class="print">
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"/>
                
                <div class="container receipt-container" style="max-width: 800px; margin: 0 auto; font-family: Arial, sans-serif;">
                    <!-- Header Section -->
                    <div class="text-center mb-4">
                        <div style="border-bottom: 3px solid #2c786c; padding-bottom: 15px;">
                            <!-- Method 1: Using image URL if stored as attachment -->
                            <t t-set="cover_image" t-value="env['dn.cover.image'].search([], limit=1)"/>
                            <t t-if="cover_image and cover_image.image">
                                <img t-attf-src="data:image/png;base64,{{ cover_image.image.decode('utf-8') }}" 
                                    alt="Organization Logo"
                                    style="width: 800px; height: auto; height: 500px; margin-bottom: 10px;"
                                    class="header-logo"/>
                            </t>
                            <t t-else="">
                                <!-- Fallback content -->
                                <h2 style="color: #2c786c; font-weight: bold; margin-bottom: 5px;">SAYLANI WELFARE TRUST</h2>
                                <p class="mb-1">A-32, Main Shabamba, Karachi, Pakistan</p>
                                <p>UAN: (+92-21) 111-722-626 | www.saylaniwelfare.com</p>
                            </t>
                        </div>
                    </div>

                    <!-- Donation Details -->
                    <div class="receipt-section" style="margin-bottom: 30px;">
                        <h4 style="color: #2c786c; border-bottom: 2px solid #2c786c; padding-bottom: 5px;">Donation Receipt</h4>
                        
                        <div class="row mb-3">
                            <div class="col-6">
                                <strong>Receipt #:</strong> <t t-esc="docs.dn_number"/>
                            </div>
                            <div class="col-6 text-right">
                                <strong>Date:</strong> <span t-esc="docs.created_at" t-options='{"widget": "date"}'/>
                            </div>
                        </div>

                        <div class="donor-info" style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                            <p class="mb-1"><strong>Donor Name:</strong> <t t-esc="docs.name"/></p>
                            <p class="mb-1"><strong>Contact:</strong> <t t-esc="docs.phone"/></p>
                            <p class="mb-0"><strong>Currency:</strong> <t t-esc="docs.currency"/></p>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-12">
                            <table class="table table-bordered">
                                <thead class="thead-light">
                                    <tr>
                                        <th class="text-center">Purpose</th>
                                        <th class="text-center">Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="docs.donation_item_ids" t-as="line">
                                        <tr>
                                            <td>
                                                <t t-esc="line.item"/>
                                            </td>
                                            <td class="text-right">
                                                <t t-esc="line.total"/>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Footer -->
                    <div class="footer-note" style="border-top: 2px solid #2c786c; padding-top: 15px; text-align: center;">
                        <p style="font-size: 0.9em; color: #666;">
                            This is computer generated receipt and does not require physical signature
                        </p>
                        <p style="font-size: 0.8em; color: #888;">
                            For any queries: contact@saylaniwelfare.com | Support: +92-21-111-722-626
                        </p>
                    </div>
                </div>
            </div>
        </t>

        <style>
            .receipt-container {
                padding: 30px;
                background: white;
            }
            
            .receipt-section {
                margin-bottom: 25px;
                padding: 15px;
                background: #fff;
            }
            
            .bank-card {
                background: #fff;
                border-radius: 5px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            @media print {
                .receipt-container {
                    max-width: 100% !important;
                    padding: 0;
                }
                .bank-card {
                    box-shadow: none;
                    border: 1px solid #ddd !important;
                }
            }
        </style>
    </template>

</odoo>