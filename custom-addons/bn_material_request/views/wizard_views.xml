<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Vendor Selection Wizard Form View -->
    <record id="vendor_selection_wizard_view_form" model="ir.ui.view">
        <field name="name">vendor.selection.wizard.form</field>
        <field name="model">vendor.selection.wizard</field>
        <field name="arch" type="xml">
            <form string="Select Vendors for RFQ Creation">
                <group>
                    <field name="source_requisition_id" invisible="1"/>
                    <field name="vendor_count" invisible="1"/>
                </group>
                <group>
                    <field name="vendor_ids" widget="many2many_tags" 
                           options="{'no_create': True, 'no_open': True}"
                           placeholder="Select multiple vendors..."/>
                </group>
                <!-- <group>
                    <div class="alert alert-info" role="alert">
                        <i class="fa fa-info-circle"/> 
                        <strong>Note:</strong> One RFQ will be created per selected vendor with all products from the source RFQ.
                    </div>
                </group> -->
                <footer>
                    <button string="Create RFQs" name="action_create_rfqs" type="object" 
                            class="btn-primary" invisible="vendor_count == 0"/>
                    <button string="Cancel" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- RFQ Price Wizard Form View -->
    <record id="rfq_price_wizard_view_form" model="ir.ui.view">
        <field name="name">rfq.price.wizard.form</field>
        <field name="model">rfq.price.wizard</field>
        <field name="arch" type="xml">
            <form string="Bulk RFQ Price Entry">
                <group>
                    <group>
                        <field name="rfq_count" readonly="1"/>
                        <field name="total_lines" readonly="1"/>
                    </group>
                    <group>
                        <field name="rfq_ids" invisible="1"/>
                        <field name="selected_rfq_id" invisible="1"/>
                        <field name="selected_rfq_name" readonly="1" invisible="selected_rfq_name == False"/>
                    </group>
                </group>
                
                <div class="alert alert-success" role="alert" invisible="selected_rfq_name == False">
                    <strong>✓ Selected RFQ:</strong> <field name="selected_rfq_name" readonly="1" nolabel="1" class="oe_inline"/> (Nearest Date + Minimum Total)
                    <br/>
                    <small><i>Note: All RFQs will be updated with prices and dates, but only this RFQ will be confirmed.</i></small>
                </div>
                <div class="alert alert-warning" role="alert" invisible="selected_rfq_name != False">
                    <strong>⚠ Warning:</strong> No RFQ has both Nearest Date and Minimum Total. Please update dates and prices.
                </div>
                
                <notebook>
                    <page string="Expected Delivery Dates" name="expected_dates">
                        <field name="rfq_line_ids" nolabel="1">
                            <tree editable="bottom" create="0" delete="0" decoration-success="is_selected" decoration-bf="is_selected">
                                <field name="wizard_id" column_invisible="1" force_save="1"/>
                                <field name="rfq_id" readonly="1" force_save="1"/>
                                <field name="rfq_name" readonly="1"/>
                                <field name="vendor_id" readonly="1" force_save="1"/>
                                <field name="expected_date" string="Expected Delivery Date"/>
                                <field name="total_amount" readonly="1" widget="monetary"/>
                                <field name="currency_id" column_invisible="1"/>
                                <field name="is_nearest_date" string="✓ Nearest" widget="boolean" readonly="1"/>
                                <field name="is_minimum_total" string="✓ Min Total" widget="boolean" readonly="1"/>
                                <field name="is_selected" string="✓ Selected" widget="boolean" readonly="1"/>
                            </tree>
                        </field>
                    </page>
                    <page string="Price Entry" name="prices">
                        <field name="line_ids" nolabel="1">
                            <tree editable="bottom" decoration-info="price_unit == 0" create="0" delete="0">
                                <field name="wizard_id" column_invisible="1" force_save="1"/>
                                <field name="rfq_line_id" column_invisible="1" force_save="1"/>
                                <field name="rfq_id" readonly="1" force_save="1"/>
                                <field name="rfq_name" readonly="1" optional="hide"/>
                                <field name="vendor_id" readonly="1" force_save="1"/>
                                <field name="product_id" readonly="1" force_save="1"/>
                                <field name="product_qty" readonly="1"/>
                                <field name="product_uom_id" readonly="1" force_save="1"/>
                                <field name="price_unit" string="Unit Price"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
                
                <footer>
                    <button string="Update All &amp; Confirm Selected" name="action_update_prices" type="object" 
                            class="btn-primary"/>
                    <button string="Cancel" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Action for Vendor Selection Wizard -->
    <record id="action_vendor_selection_wizard" model="ir.actions.act_window">
        <field name="name">Select Vendors</field>
        <field name="res_model">vendor.selection.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_material_request_id': active_id}</field>
    </record>

    <!-- Action for RFQ Price Wizard (called from Purchase Order list view) -->
    <record id="action_rfq_price_wizard" model="ir.actions.act_window">
        <field name="name">Bulk Price Entry</field>
        <field name="res_model">rfq.price.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="binding_model_id" ref="purchase.model_purchase_order"/>
        <field name="binding_view_types">list</field>
    </record>

</odoo>
