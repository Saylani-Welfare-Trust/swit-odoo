<?xml version="1.0" encoding="utf-8"?>
<templates id="template" xml:space="preserve">

    <t t-name="bn_pos_customization.OrderReceipt" t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">
        <xpath expr="//div[hasclass('pos-receipt')]" position="replace">
            <div class="pos-receipt" style="page-break-inside: avoid; min-height: 0; font-family: Arial, sans-serif;">

                <t t-set="company" t-value="props.data.headerData.company"/>
                <t t-set="order" t-value="props.data"/>
                <t t-set="partner" t-value="props.data.partner"/>
                <t t-set="lines" t-value="props.data.orderlines"/>
                <t t-set="payment" t-value="props.data.paymentlines[0]"/>
                <t t-set="date_format" t-value="order.date" />
                <t t-set="format_currency_amount_zero" t-value="props.formatCurrency(0)" />
                <t t-set="format_currency_amount" t-value="props.formatCurrency(order.amount_total)" />

                <!-- Top Space -->
                <div style="height: 360px;"></div>

                <!-- Header Row -->
                <div class="row" style="font-size: 14px; transform: scale(0.99); transform-origin: top;">
                    <div class="col-4">
                        <h1 class="fs-3 fw-bold text-uppercase" t-if="order.receive_voucher">Receipt Voucher</h1>
                        <h1 class="fs-3 fw-bold text-uppercase" t-if="!order.receive_voucher">Donation Receipt</h1>
                    </div>
                    <div class="col-8 text-end">
                        <b class="fw-bold text-uppercase">
                            <t t-if="company.name"><t t-esc="company.name"/></t>
                            <t t-if="order.branch_name">(<t t-esc="order.branch_name"/>)</t>
                        </b>
                    </div>
                </div>

                <!-- Donor & Receipt Info -->
                <div class="row p-2" style="font-size: 14px; line-height: 1.1;">
                    <!-- Left Column -->
                    <div class="col-6">
                        <div class="row mb-1">
                            <div class="col-4 fw-medium">DN #:</div>
                            <div class="col-8">
                                <t t-set="city_code" t-value="order.branch_code or 'UNK'"/>
                                <t t-set="branch_code" t-value="company.name.substring(0,3).toUpperCase() or 'UNK'"/>
                                <t t-set="current_year" t-value="new Date().getFullYear()"/>
                                <t t-set="random_no" t-value="order.name and order.name.slice(-4) or '0000'"/>
                                <span class="fw-medium"><t t-esc="city_code"/>-<t t-esc="branch_code"/>-<t t-esc="current_year"/>-<t t-esc="random_no"/></span>
                            </div>
                        </div>

                        <div class="row mb-1">
                            <div class="col-4 fw-medium">Donor Name:</div>
                            <div class="col-8 fw-medium">
                                <t t-if="partner.name"><t t-esc="partner.name"/></t>
                                <t t-else="">-</t>
                            </div>
                        </div>

                        <div class="row mb-1">
                            <div class="col-4 fw-medium">Payment Method:</div>
                            <div class="col-8 fw-medium">
                                <t t-if="payment.name"><t t-esc="payment.name"/></t>
                                <t t-else="">-</t>
                            </div>
                        </div>

                        <!-- Conditional Bank / Reference -->
                        <t t-if="payment.name == 'Cheque'">
                            <div class="row mb-1" t-if="order.bank_name">
                                <div class="col-4 fw-medium">Bank Name:</div>
                                <div class="col-8 fw-medium"><t t-esc="order.bank_name"/></div>
                            </div>
                        </t>

                        <t t-if="payment.name == 'Credit Card'">
                            <div class="row mb-1" t-if="order.bank_name">
                                <div class="col-4 fw-medium">Reference No:</div>
                                <div class="col-8 fw-medium"><t t-esc="order.bank_name"/></div>
                            </div>
                        </t>
                    </div>

                    <!-- Right Column -->
                    <div class="col-6">
                        <div class="row mb-1">
                            <div class="col-4 fw-medium">Date Time:</div>
                            <div class="col-8 fw-medium">
                                <t t-set="dateObj" t-value="new Date(date_format)"/>
                                <t t-set="day" t-value="dateObj.getDate()"/>
                                <t t-set="month" t-value="dateObj.getMonth() + 1"/>
                                <t t-set="year" t-value="dateObj.getFullYear()"/>
                                <t t-set="hours" t-value="dateObj.getHours()"/>
                                <t t-set="minutes" t-value="dateObj.getMinutes()"/>
                                <t t-set="seconds" t-value="dateObj.getSeconds()"/>
                                <t t-esc="(day &lt; 10 ? '0' : '') + day + '-' +
                                           (month &lt; 10 ? '0' : '') + month + '-' + year + ' ' +
                                           (hours &lt; 10 ? '0' : '') + hours + ':' +
                                           (minutes &lt; 10 ? '0' : '') + minutes"/>
                            </div>
                        </div>

                        <div class="row mb-1">
                            <div class="col-4 fw-medium">Contact No:</div>
                            <div class="col-8 fw-medium">
                                <t t-if="partner.mobile"><t t-esc="partner.mobile"/></t>
                                <t t-else="">
                                    <t t-if="partner.phone"><t t-esc="partner.phone"/></t>
                                    <t t-else="">-</t>
                                </t>
                            </div>
                        </div>

                        <div class="row mb-1">
                            <div class="col-4 fw-medium">Total Amount:</div>
                            <div class="col-8 fw-medium">
                                <t t-if="order.amount_total"><t t-esc="format_currency_amount"/></t>
                                <t t-else=""><t t-esc="format_currency_amount_zero"/></t>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Items Table -->
                <table class="table table-bordered text-center mt-1" style="font-size: 14px; line-height: 1; page-break-inside: avoid;">
                    <thead>
                        <tr>
                            <th class="py-1">Product</th>
                            <th class="py-1">Quantity</th>
                            <th class="py-1">Rate</th>
                            <th class="py-1">Amount</th>
                            <th class="py-1">Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="lines" t-as="line" t-key="line.id+line.productName">
                            <tr style="page-break-inside: avoid;">
                                <td class="text-start py-1"><t t-if="line.productName"><t t-esc="line.productName"/></t><t t-else="">-</t></td>
                                <td class="text-end py-1"><t t-if="line.qty"><t t-esc="line.qty"/></t><t t-else="">-</t></td>
                                <td class="text-end py-1"><t t-if="line.unitPrice"><t t-esc="line.unitPrice"/></t><t t-else="">-</t></td>
                                <td class="text-end py-1"><t t-if="line.price"><t t-esc="line.price"/></t><t t-else="">-</t></td>
                                <td class="text-start py-1"><t t-if="line.customerNote"><t t-esc="line.customerNote"/></t><t t-else="">-</t></td>
                            </tr>
                        </t>
                    </tbody>
                </table>

                <div class="row p-2" style="font-size: 14px; line-height: 1.1;">
                    <div class="col-6">
                        <!-- Conditional Bank / Reference -->
                        <div class="row mb-1">
                            <div class="col-4 fw-medium">Enter By:</div>
                            <div class="col-8 fw-medium"><t t-esc="order.cashier"/></div>
                        </div>

                        <div class="row mb-1">
                            <div class="col-4 fw-medium">Total Amount:</div>
                            <div class="col-8 fw-medium"><t t-esc="order.amount_total"/></div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-1" style="font-size: 12px; line-height: 1; page-break-inside: avoid;">
                    Powered by BytesNode
                </div>

            </div>
        </xpath>
    </t>

</templates>
