<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record id="advance_donation_tree" model="ir.ui.view">
        <field name="name">advance.donation.tree</field>
        <field name="model">advance.donation</field>
        <field name="arch" type="xml">
            <tree default_order="create_date desc">
                <field name="currency_id" column_invisible="1"/>
                <field name="name"/>
                <field name="donor_id"/>
                <field name="payment_type"/>
                <field name="total_product_amount"/>
                <field name="paid_amount"/>
                <field name="remaining_amount"/>
                <field name="state" widget="badge" decoration-info="state == 'draft'" decoration-success="state in ('approved')"/>
            </tree>
        </field>
    </record>

    <record id="advance_donation_form" model="ir.ui.view">
        <field name="name">advance.donation.form</field>
        <field name="model">advance.donation</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="compute_donation" string="Compute Donation" type="object" class="oe_highlight" invisible="state != 'draft'"/>
                    <button name="action_send_for_approval" string="Send for Approval" type="object" class="oe_highlight" invisible="state != 'draft'"/>
                    <button name="action_approved" invisible="state != 'approval_1'" string="Approve" type="object" class="oe_highlight" groups="bn_advance_donation.group_adv_don_approval_1"/>
                    <button name="action_approved" invisible="state != 'approval_2'" string="Approve" type="object" class="oe_highlight" groups="bn_advance_donation.group_adv_don_approval_2"/>
                    <button name="action_rejected" invisible="state != 'approval_1'" string="Reject" type="object" groups="bn_advance_donation.group_adv_don_approval_1"/>
                    <button name="action_rejected" invisible="state != 'approval_2'" string="Reject" type="object" groups="bn_advance_donation.group_adv_don_approval_2"/>
                    <button name="action_revert" invisible="state != 'approval_1'" string="Revert" type="object" groups="bn_advance_donation.group_adv_don_approval_1"/>
                    <button name="action_revert" invisible="state != 'approval_2'" string="Revert" type="object" groups="bn_advance_donation.group_adv_don_approval_2"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,approval_1,approval_2,approved"/>
                </header>
                <sheet>
                    <field name="product_domain_ids" invisible="1"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="is_revert" invisible="1"/>

                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="donor_id" required="1" readonly="state != 'draft'"/>
                            <field name="category_id" required="1" options="{'no_create': True, 'no_edit': True}" readonly="state != 'draft'"/>
                            <field name="contract_type" required="1" readonly="state != 'draft'"/>
                            <field name="contract_frequency" required="1" invisible="contract_type == 'product'" readonly="state != 'draft'"/>
                            <field name="total_product_amount" readonly="1" force_save="1"/>
                            <field name="donation_slip_ids" domain="[('state', '=', 'paid'), ('donor_id', '=', donor_id), ('remaining_amount', '>', 0)]" invisible="is_fully_paid == True" widget="many2many_tags" options="{'no_create': True, 'no_edit': True}"  readonly="state != 'draft'" force_save="1"/>
                            <field name="donation_slip_ids" domain="[('state', '=', 'paid'), ('donor_id', '=', donor_id), ('remaining_amount', '>', 0), ('id', 'in', donation_slip_ids)]" invisible="is_fully_paid == False" widget="many2many_tags" options="{'no_create': True, 'no_edit': True}"  readonly="state != 'draft'" force_save="1"/>
                            <field name="approval_1_remarks" invisible="state not in ('approval_1', 'rejected')" force_save="1" readonly="state in ('rejected', 'draft')"/>
                            <field name="approval_2_remarks" invisible="state not in ('approval_2', 'rejected')" force_save="1" readonly="state in ('rejected', 'draft')"/>
                            <field name="approval_1_remarks" invisible="is_revert != True or is_revert == True and state != 'draft'" force_save="1" readonly="state in ('draft')"/>
                            <field name="approval_2_remarks" invisible="is_revert != True or is_revert == True and state not in ('draft', 'approval_1')" force_save="1" readonly="state in ('draft', 'approval_1')"/>
                            <field name="is_fully_paid" invisible="1"/>
                            <field name="is_fully_disbursed" invisible="1"/>
                        </group>
                        <group>
                            <field name="product_id" domain="[('id', 'in', product_domain_ids)]" required="1" options="{'no_create': True, 'no_edit': True}" readonly="state != 'draft'"/>
                            <field name="no_of_product" invisible="contract_type == 'product'" readonly="state != 'draft'"/>
                                <label for="amount_percentage"/>
                            <div>
                                <field name="amount_percentage" class="oe_inline" readonly="state != 'draft'"/>
                                <span class="o_form_label oe_inline">%</span>
                            </div>
                            <field name="contract_start_date" string="Date" widget="daterange" options="{'end_date_field': 'contract_end_date'}" invisible="contract_type == 'product'" readonly="state != 'draft'"/>
                            <field name="contract_end_date" invisible="1"/>
                            <field name="no_of_days" readonly="1" force_save="1" invisible="contract_frequency == 'weekly' or contract_type == 'product'"/>
                            <field name="no_of_weeks" readonly="1" force_save="1" invisible="contract_frequency == 'daily' or contract_type == 'product'"/>
                            <field name="total_no_of_product" readonly="contract_type == 'frequency' or state != 'draft'" force_save="1"/>
                            <field name="approved_date" invisible="state != 'approved'" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Donation Lines">
                            <field name="advance_donation_lines" readonly="1" force_save="1">
                                <tree editable="bottom">
                                    <field name="serial_no"/>
                                    <field name="product_id"/>
                                    <field name="amount"/>
                                    <field name="paid_amount" />
                                    <field name="remaining_amount"/>
                                    <field name="state" force_save="1" widget="badge" decoration-danger="state == 'unpaid'" decoration-warning="state == 'partial'" decoration-success="state == 'paid'" />
                                    <field name="is_disbursed"/>
                                    <field name="donation_state" column_invisible="1"/>
                                    <field name="approved_date" column_invisible="1"/>
                                    <field name="currency_id" column_invisible="1"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Usage Lines" invisible="1">
                            <field name="donation_slip_usage_lines">
                                <tree editable="bottom">
                                    <field name="donation_slip_id"/>
                                    <field name="usage_amount"/>
                                    <field name="currency_id" column_invisible="1"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_advance_donation" model="ir.actions.act_window">
        <field name="name">Advance Donation</field>
        <field name="res_model">advance.donation</field>
        <field name="view_mode">tree,form</field>
    </record>

</odoo>