<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="sm_point_of_sale_apps.ProductsWidget" t-inherit="point_of_sale.ProductsWidget" t-inherit-mode="extension">
        <xpath expr="//div[hasclass('products-widget')]" position="replace">
            <div class="products-widget d-flex flex-column flex-grow-1 overflow-hidden" t-ref="products-widget">
                <t t-set="showCategoryImages" t-value="getShowCategoryImages()" />
                
                <!-- Category and Search Section - Fixed at top -->
                <div class="products-widget-control d-flex bg-view shadow-sm" style="flex-direction: column; flex-shrink: 0; z-index: 10;">
                    <!-- Category Section with dynamic height -->
                    <div class="category-section" style="flex-shrink: 0;">
                        <CategorySelector
                            categories="getCategories()"
                            onClick="(id) => this.pos.setSelectedCategoryId(id)"
                            showImage="showCategoryImages"
                            class="ui.isSmall ? 'scrollbar-hidden' : ''"
                        />
                    </div>
                    
                    <!-- Search Section - Always positioned correctly after categories -->
                    <div class="search-section" style="flex-shrink: 0; padding: 8px; border-top: 1px solid #dee2e6;">
                        <Input tModel="[pos, 'searchProductWord']"
                            class="''"
                            isSmall="ui.isSmall"
                            placeholder="'Search products...'"
                            icon="{type: 'fa', value: 'fa-search'}"
                            debounceMillis="500"
                        />
                    </div>
                </div>
                
                <!-- Product Section - Scrollable with background -->
                <div class="product-list-container flex-grow-1 overflow-y-auto position-relative"  
                     t-att-style="productsToDisplay.length == 0 ? 'background-image: url(\'/sm_point_of_sale_apps/static/src/images/logn_ew.jpg\'); background-size: cover; background-repeat: no-repeat; background-position: center;' : ''">
                    
                    <!-- Products Display -->
                    <div t-if="productsToDisplay.length != 0 and pos.posHasValidProduct()" t-attf-class="product-list {{this.pos.productListViewMode}} p-2" 
                    style="background: rgba(255,255,255,0.95); min-height: 180px; display: flex; flex-direction: column;">
                        <t t-foreach="productsToDisplay" t-as="product" t-key="product.id">
                            
                            <ProductCard
                                class="pos.productViewMode"
                                name="product.display_name"
                                productId="product.id"
                                price="product.getFormattedUnitPrice()"
                                imageUrl="pos.show_product_images and product.getImageUrl()"
                                onClick="() =>this.pos.addProductToCurrentOrder(product)"
                                productInfo="true"
                                onProductInfoClick="() => this.onProductInfoClick(product)"
                            />
                        </t>
                    </div>
                    
                    <!-- Empty State with Background -->
                    <div t-else="" class="product-list-empty no-results-message text-center position-absolute top-50 start-50 translate-middle" style="z-index: 5;">
                        <t t-if="searchWord">
                            <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                <p style="color: #060606; margin: 0;">No products found for <b>"<t t-esc="searchWord"/>"</b> in this category.</p>
                            </div>
                        </t>
                        <t t-else="">
                            <t t-if="pos.posHasValidProduct()">
                                <div style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                    <p style="color: #060606; margin: 0;">There are no products in this category.</p>
                                </div>
                            </t>
                            <t t-else="">
                                <div t-if="!state.loadingDemo" style="background: rgba(255,255,255,0.9); padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                    <div>
                                        <p style="color: #060606; margin: 0;" class="text-large">No products available. Explore <a role="button" class="button-no-demo fw-bolder" t-on-click="loadDemoDataProducts">demo data</a> or <a role="button" class="button-no-demo fw-bolder" t-on-click="createNewProducts">create your own</a>.</p>
                                    </div>
                                </div>
                                <div t-else="" class="block-top-header position-absolute top-0 start-0 bg-black opacity-50 w-100 h-100 z-1000">
                                    <div class="d-flex h-100 w-100 text-white flex-row align-items-center justify-content-center">
                                        <div class="o_spinner d-flex flex-column mb-4">
                                            <div>
                                                <img src="/web/static/img/spin.svg" alt="Loading..."/>
                                                Loading...
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </t>
                    </div>
                    
                    <!-- Search More Button -->
                    <div t-if="searchWord" class="search-more-button d-flex justify-content-center position-absolute bottom-0 start-0 w-100" style="z-index: 5; padding: 10px; background: rgba(255,255,255,0.9);">
                        <button class="btn btn-primary btn-lg" t-on-click="onPressEnterKey">Search more</button>
                    </div>
                    
                    <div class="portal search-database-button no-results-message" t-att-class="{ 'd-none':  !shouldShowButton }"></div>
                </div>
            </div>
        </xpath>
    </t>
</templates>